<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexus Terminal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap');

    :root {
      --glass-bg: rgba(15, 23, 42, 0.7);
      --glass-border: rgba(255, 255, 255, 0.1);
      --neon-blue: #38bdf8;
      --neon-purple: #818cf8;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: radial-gradient(circle at top left, #0f172a, #1e1b4b);
      height: 100vh;
      margin: 0;
      overflow: hidden;
      color: #e2e8f0;
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }

    .tab-active {
      background: rgba(56, 189, 248, 0.2);
      border-bottom: 2px solid var(--neon-blue);
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .command-output-card {
      border-left: 3px solid var(--neon-blue);
      background: rgba(255, 255, 255, 0.03);
      transition: all 0.2s ease;
    }

    .command-output-card:hover {
      transform: translateX(4px);
      background: rgba(255, 255, 255, 0.05);
    }

    .suggestion-hint {
      color: rgba(255, 255, 255, 0.3);
      pointer-events: none;
    }

    .status-badge {
      font-size: 0.65rem;
      padding: 1px 6px;
      border-radius: 4px;
      text-transform: uppercase;
      font-weight: bold;
    }

    .ai-message {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .sticky-input-container {
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, rgba(15, 23, 42, 0.95) 70%, transparent);
      backdrop-filter: blur(8px);
      padding: 1.5rem;
      margin: 0 -1.5rem -1.5rem -1.5rem;
      z-index: 10;
    }

    .action-btn {
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .command-output-card:hover .action-btn {
      opacity: 1;
    }
  </style>
</head>

<body class="p-4 md:p-8 flex items-center justify-center">

  <div
    class="w-full max-w-6xl h-[85vh] glass rounded-3xl overflow-hidden flex flex-col relative border-white/10 shadow-2xl">

    <!-- Header / Tabs -->
    <div class="flex items-center bg-black/40 border-b border-white/10 px-4 h-14 shrink-0">
      <div class="flex gap-2 mr-6">
        <div class="w-3 h-3 rounded-full bg-red-500/80"></div>
        <div class="w-3 h-3 rounded-full bg-yellow-500/80"></div>
        <div class="w-3 h-3 rounded-full bg-green-500/80"></div>
      </div>

      <div id="tabs-container" class="flex flex-1 overflow-x-auto custom-scrollbar h-full items-end gap-1 px-2"></div>

      <button onclick="createNewTab()"
        class="ml-2 p-2 hover:bg-white/10 rounded-lg transition-colors text-white/60 hover:text-white">
        <i class="fa-solid fa-plus text-sm"></i>
      </button>
    </div>

    <!-- Sidebar -->
    <div class="flex flex-1 overflow-hidden">
      <aside
        class="w-64 border-r border-white/10 bg-black/20 p-4 flex flex-col gap-6 hidden md:flex overflow-y-auto custom-scrollbar">
        <div id="ai-commentary" class="bg-blue-500/10 border border-blue-400/20 p-3 rounded-xl ai-message">
          <div class="flex items-center gap-2 text-blue-400 font-bold text-[10px] mb-1">
            <i class="fa-solid fa-wand-magic-sparkles"></i> AI ASSISTANT
          </div>
          <p id="ai-text" class="text-xs text-white/80 leading-relaxed italic">Ready for operations.</p>
        </div>

        <div>
          <h3 class="text-xs font-bold text-white/40 uppercase tracking-widest mb-3 flex items-center gap-2">
            <i class="fa-solid fa-folder text-[10px]"></i> Recent
          </h3>
          <div id="recent-folders" class="flex flex-col gap-1 text-sm"></div>
        </div>

        <div>
          <h3 class="text-xs font-bold text-white/40 uppercase tracking-widest mb-3 flex items-center gap-2">
            <i class="fa-solid fa-clock-rotate-left text-[10px]"></i> Global History
          </h3>
          <div id="global-history" class="flex flex-col gap-2 text-xs opacity-80"></div>
        </div>
      </aside>

      <!-- Main Terminal Body -->
      <main id="terminal-viewport" class="flex-1 flex flex-col p-6 overflow-y-auto custom-scrollbar relative">
        <div id="output-area" class="flex flex-col gap-4 mb-8">
          <div class="flex flex-col gap-2 mb-4">
            <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
              NexusOS v2.0</div>
            <p class="text-white/40 text-sm italic">Secure glassmorphic environment initialized.</p>
          </div>
        </div>

        <!-- Sticky Command Input Section -->
        <div class="sticky-input-container">
          <div class="glass border-white/20 p-4 rounded-2xl flex flex-col gap-2 shadow-2xl">
            <div
              class="flex flex-wrap items-center gap-4 text-[10px] font-bold uppercase tracking-wider text-white/50 mb-1 border-b border-white/5 pb-2">
              <div class="flex items-center gap-1.5 text-blue-400 bg-blue-400/10 px-2 py-0.5 rounded">
                <i class="fa-solid fa-folder-tree"></i>
                <span id="current-path">~</span>
              </div>
              <div class="flex items-center gap-1.5 text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded">
                <i class="fa-solid fa-code-branch"></i>
                <span id="git-branch">main</span>
              </div>
            </div>

            <div class="relative flex items-center">
              <span class="text-blue-400 font-bold mr-3 shrink-0">❯</span>
              <div class="relative flex-1">
                <span id="suggestion-hint" class="suggestion-hint absolute inset-0 py-0"></span>
                <input id="terminal-input" type="text" autofocus
                  class="bg-transparent border-none outline-none w-full text-white placeholder-white/20"
                  placeholder="Execute command..." autocomplete="off">
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // State
    let tabs = [{ id: 1, name: 'Main', path: '~/nexus', history: [] }];
    let activeTabId = 1;
    let commandHistory = []; // Global history log
    let folderHistory = ['~/nexus', '/var/logs'];

    const FS = {
      '~': ['nexus', 'downloads', 'documents'],
      '~/nexus': ['src', 'docs', 'README.md'],
      '~/nexus/src': ['index.js', 'app.js'],
      '/var/logs': ['system.log']
    };

    const COMMAND_LIST = ['ls', 'cd', 'help', 'clear', 'git', 'whoami', 'date', 'pwd'];

    const terminalInput = document.getElementById('terminal-input');
    const outputArea = document.getElementById('output-area');
    const tabsContainer = document.getElementById('tabs-container');
    const currentPathEl = document.getElementById('current-path');
    const recentFoldersEl = document.getElementById('recent-folders');
    const globalHistoryEl = document.getElementById('global-history');
    const aiTextEl = document.getElementById('ai-text');
    const suggestionHint = document.getElementById('suggestion-hint');
    const viewport = document.getElementById('terminal-viewport');

    function init() {
      renderTabs();
      renderRecentFolders();
      updateUI();
      terminalInput.addEventListener('keydown', handleKeyDown);
      terminalInput.addEventListener('input', handleInput);
    }

    function updateUI() {
      const activeTab = tabs.find(t => t.id === activeTabId);
      currentPathEl.textContent = activeTab.path;
      outputArea.innerHTML = '';

      if (activeTab.history.length === 0) {
        outputArea.innerHTML = `
                    <div class="flex flex-col gap-2 mb-4">
                        <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">NexusOS</div>
                        <p class="text-white/40 text-sm italic">Session active in ${activeTab.path}</p>
                    </div>`;
      } else {
        activeTab.history.forEach((h, index) => renderOutputCard(h, index));
      }
      scrollToBottom();
    }

    function scrollToBottom() {
      viewport.scrollTo({ top: viewport.scrollHeight, behavior: 'smooth' });
    }

    function handleInput(e) {
      const val = e.target.value;
      if (!val) { suggestionHint.textContent = ''; return; }
      const match = COMMAND_LIST.find(c => c.startsWith(val.toLowerCase()));
      suggestionHint.textContent = match || '';
    }

    function handleKeyDown(e) {
      if (e.key === 'Enter') {
        const cmd = terminalInput.value.trim();
        if (cmd) executeCommand(cmd);
        terminalInput.value = '';
        suggestionHint.textContent = '';
      } else if (e.key === 'Tab') {
        e.preventDefault();
        if (suggestionHint.textContent) {
          terminalInput.value = suggestionHint.textContent;
          suggestionHint.textContent = '';
        }
      }
    }

    function executeCommand(cmdLine) {
      const [cmd, ...args] = cmdLine.toLowerCase().split(' ');
      let output = '';
      let status = 'success';
      const activeTab = tabs.find(t => t.id === activeTabId);

      switch (cmd) {
        case 'help': output = `System commands: ${COMMAND_LIST.join(', ')}`; break;
        case 'ls':
          output = (FS[activeTab.path] || []).join('  ');
          break;
        case 'cd':
          const target = args[0] || '~';
          let newPath = target === '..' ? goUp(activeTab.path) : (FS[target] ? target : (FS[activeTab.path + '/' + target] ? activeTab.path + '/' + target : null));
          if (newPath) {
            activeTab.path = newPath;
            if (!folderHistory.includes(newPath)) folderHistory.unshift(newPath);
            output = `Switched to ${newPath}`;
            renderRecentFolders();
          } else { output = `Directory not found: ${target}`; status = 'error'; }
          break;
        case 'clear': activeTab.history = []; updateUI(); return;
        case 'date': output = new Date().toLocaleString(); break;
        case 'whoami': output = 'nexus_admin'; break;
        default: output = `Command '${cmd}' unrecognized.`; status = 'error';
      }

      const historyItem = { cmd: cmdLine, output, status, timestamp: new Date() };
      activeTab.history.push(historyItem);
      commandHistory.unshift({ cmd: cmdLine, tabName: activeTab.name });

      updateUI();
      updateGlobalHistory();
      updateAI(status === 'success' ? 'Command processed successfully.' : 'Operation failed.', status);
    }

    function renderOutputCard(item, index) {
      const div = document.createElement('div');
      div.className = 'command-output-card p-4 rounded-xl flex flex-col gap-2 ai-message group';
      div.style.borderLeftColor = item.status === 'error' ? '#ef4444' : '#38bdf8';

      div.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-blue-400 font-bold">❯</span>
                        <span class="text-white font-medium">${item.cmd}</span>
                        <span class="status-badge ${item.status === 'error' ? 'bg-red-500/20 text-red-400' : 'bg-emerald-500/20 text-emerald-400'}">${item.status}</span>
                    </div>
                    <div class="flex items-center gap-2 action-btn">
                        <button onclick="executeCommand('${item.cmd}')" title="Re-run" class="p-1.5 hover:bg-white/10 rounded-md text-white/40 hover:text-blue-400 transition-colors">
                            <i class="fa-solid fa-rotate-right text-[10px]"></i>
                        </button>
                        <button onclick="copyToClipboard('${item.output}')" title="Copy Output" class="p-1.5 hover:bg-white/10 rounded-md text-white/40 hover:text-emerald-400 transition-colors">
                            <i class="fa-solid fa-copy text-[10px]"></i>
                        </button>
                        <button onclick="deleteEntry(${index})" title="Delete" class="p-1.5 hover:bg-white/10 rounded-md text-white/40 hover:text-red-400 transition-colors">
                            <i class="fa-solid fa-trash text-[10px]"></i>
                        </button>
                    </div>
                </div>
                <div class="text-sm text-white/70 whitespace-pre-wrap font-mono">${item.output}</div>
            `;
      outputArea.appendChild(div);
    }

    function deleteEntry(index) {
      const activeTab = tabs.find(t => t.id === activeTabId);
      activeTab.history.splice(index, 1);
      updateUI();
      updateAI('Entry removed from session.', 'success');
    }

    function copyToClipboard(text) {
      const el = document.createElement('textarea');
      el.value = text;
      document.body.appendChild(el);
      el.select();
      document.execCommand('copy');
      document.body.removeChild(el);
      updateAI('Output copied to clipboard.', 'success');
    }

    function goUp(path) {
      if (path === '~') return null;
      const parts = path.split('/');
      parts.pop();
      return parts.join('/') || '~';
    }

    function updateAI(text, type) {
      aiTextEl.textContent = text;
      const container = document.getElementById('ai-commentary');
      container.className = `bg-${type === 'error' ? 'red' : 'blue'}-500/10 border border-${type === 'error' ? 'red' : 'blue'}-400/20 p-3 rounded-xl ai-message`;
    }

    function createNewTab() {
      const id = tabs.length + 1;
      tabs.push({ id, name: `Session ${id}`, path: '~', history: [] });
      switchTab(id);
    }

    function switchTab(id) {
      activeTabId = id;
      renderTabs();
      updateUI();
    }

    function renderTabs() {
      tabsContainer.innerHTML = '';
      tabs.forEach(tab => {
        const button = document.createElement('button');
        button.className = `px-4 py-2 text-xs font-bold transition-all flex items-center gap-2 rounded-t-lg ${tab.id === activeTabId ? 'tab-active text-blue-400 bg-white/5' : 'text-white/40 hover:bg-white/5'}`;
        button.onclick = () => switchTab(tab.id);
        button.innerHTML = `<i class="fa-solid fa-terminal"></i> ${tab.name}`;
        tabsContainer.appendChild(button);
      });
    }

    function renderRecentFolders() {
      recentFoldersEl.innerHTML = '';
      folderHistory.slice(0, 5).forEach(folder => {
        const div = document.createElement('div');
        div.className = 'p-2 hover:bg-white/5 rounded-lg cursor-pointer transition-colors flex items-center gap-2 group';
        div.onclick = () => executeCommand(`cd ${folder}`);
        div.innerHTML = `<i class="fa-solid fa-folder-open text-white/20 group-hover:text-blue-400"></i> <span class="truncate">${folder}</span>`;
        recentFoldersEl.appendChild(div);
      });
    }

    function updateGlobalHistory() {
      globalHistoryEl.innerHTML = '';
      commandHistory.slice(0, 8).forEach(h => {
        const div = document.createElement('div');
        div.className = 'flex flex-col gap-0.5 border-l border-white/5 pl-2 mb-1 cursor-pointer hover:border-blue-400 transition-colors group';
        div.onclick = () => executeCommand(h.cmd);
        div.innerHTML = `
                    <span class="text-white/60 truncate group-hover:text-blue-400">${h.cmd}</span>
                    <span class="text-[9px] text-white/20 uppercase font-bold">${h.tabName}</span>
                `;
        globalHistoryEl.appendChild(div);
      });
    }

    window.onload = init;
  </script>
</body>

</html>