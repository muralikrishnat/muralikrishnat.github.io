<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Insight Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .log-row:hover {
            background-color: #f1f5f9;
        }

        .status-error { color: #ef4444; background: #fee2e2; }
        .status-warn { color: #f59e0b; background: #fef3c7; }
        .status-info { color: #3b82f6; background: #dbeafe; }
        .status-debug { color: #64748b; background: #f1f5f9; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="box-8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
            <h1 class="text-xl font-semibold text-slate-800 tracking-tight">LogInsight <span class="text-slate-400 font-normal">v1.0</span></h1>
        </div>
        <div class="flex gap-2">
            <button id="generateBtn" class="px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100 rounded-md transition-colors border border-slate-200">
                Generate Random Logs
            </button>
            <button id="clearBtn" class="px-4 py-2 text-sm font-medium text-white bg-slate-800 hover:bg-slate-700 rounded-md transition-colors">
                Clear All
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col overflow-hidden">
        
        <!-- Filter Builder Section -->
        <section class="bg-white border-b border-slate-200 p-6 shadow-sm z-10">
            <div class="max-w-6xl mx-auto">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-semibold text-slate-700 uppercase tracking-wider">Active Filters</span>
                        <span id="filterCount" class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-0.5 rounded-full">0</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center bg-slate-100 rounded-lg p-1">
                            <button onclick="setLogic('AND')" id="logicAnd" class="px-3 py-1 text-xs font-bold rounded-md transition-all bg-white shadow-sm text-indigo-600">AND</button>
                            <button onclick="setLogic('OR')" id="logicOr" class="px-3 py-1 text-xs font-bold rounded-md transition-all text-slate-500">OR</button>
                        </div>
                        <button id="addFilterBtn" class="flex items-center gap-1 text-sm font-medium text-indigo-600 hover:text-indigo-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="PlusCircle-10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                            </svg>
                            Add Rule
                        </button>
                    </div>
                </div>

                <!-- Filter Container -->
                <div id="filterContainer" class="flex flex-wrap gap-3 empty:hidden mb-4">
                    <!-- Filters injected here -->
                </div>

                <div id="noFiltersMsg" class="text-slate-400 text-sm italic py-2">
                    No active filters. Showing all logs.
                </div>
            </div>
        </section>

        <!-- Stats Bar -->
        <div class="bg-slate-50 px-6 py-2 border-b border-slate-200 flex justify-between items-center text-xs text-slate-500 font-medium uppercase tracking-widest">
            <div class="flex gap-6">
                <span>Total: <span id="statTotal" class="text-slate-800">0</span></span>
                <span>Filtered: <span id="statFiltered" class="text-indigo-600">0</span></span>
            </div>
            <div id="statusIndicator" class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                Live Monitoring
            </div>
        </div>

        <!-- Log Table -->
        <div class="flex-1 overflow-auto custom-scrollbar relative">
            <table class="w-full text-left border-collapse min-w-[800px]">
                <thead class="sticky top-0 bg-white shadow-sm z-20">
                    <tr class="text-slate-500 text-xs uppercase tracking-wider border-b border-slate-200">
                        <th class="px-6 py-3 font-semibold w-48">Timestamp</th>
                        <th class="px-4 py-3 font-semibold w-24 text-center">Level</th>
                        <th class="px-4 py-3 font-semibold w-40">Service</th>
                        <th class="px-6 py-3 font-semibold">Message</th>
                    </tr>
                </thead>
                <tbody id="logBody" class="divide-y divide-slate-100 mono text-sm text-slate-700">
                    <!-- Logs injected here -->
                </tbody>
            </table>
            
            <div id="emptyState" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white">
                <div class="text-slate-300 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <p class="text-slate-500 font-medium">No logs found matching your criteria</p>
                <button onclick="resetFilters()" class="mt-4 text-indigo-600 text-sm font-semibold hover:underline">Clear all filters</button>
            </div>
        </div>
    </main>

    <script>
        // --- State Management ---
        let logs = [];
        let filters = []; // { id, field, operator, value }
        let currentLogic = 'AND'; // OR

        const fields = ['timestamp', 'level', 'service', 'message'];
        const operators = [
            { id: 'contains', label: 'contains' },
            { id: 'equals', label: 'equals' },
            { id: 'startswith', label: 'starts with' },
            { id: 'endswith', label: 'ends with' }
        ];

        // --- Data Mocking ---
        const services = ['Auth-Service', 'Payment-Gateway', 'User-API', 'Redis-Cache', 'Worker-Node-01'];
        const levels = ['INFO', 'WARN', 'ERROR', 'DEBUG'];
        const messages = [
            "User login successful for user_821",
            "Connection timeout detected on port 5432",
            "Database migration completed in 450ms",
            "Invalid bearer token provided",
            "Cache miss for key: session_df21",
            "Transaction processed successfully",
            "High CPU usage detected on cluster-02",
            "Failed to fetch resource from CDN",
            "Webhook delivered to https://partner.api/v1",
            "Resource temporarily unavailable"
        ];

        function generateLog() {
            return {
                id: Math.random().toString(36).substr(2, 9),
                timestamp: new Date().toISOString().replace('T', ' ').substr(0, 19),
                level: levels[Math.floor(Math.random() * levels.length)],
                service: services[Math.floor(Math.random() * services.length)],
                message: messages[Math.floor(Math.random() * messages.length)]
            };
        }

        // --- UI Logic ---
        function renderFilters() {
            const container = document.getElementById('filterContainer');
            const noMsg = document.getElementById('noFiltersMsg');
            const count = document.getElementById('filterCount');
            
            container.innerHTML = '';
            filters.forEach((f, index) => {
                const badge = document.createElement('div');
                badge.className = 'flex items-center gap-1 bg-indigo-50 border border-indigo-100 px-3 py-1.5 rounded-full text-xs transition-all animate-in fade-in zoom-in duration-200';
                badge.innerHTML = `
                    <span class="text-indigo-400 font-bold uppercase mr-1">${f.field}</span>
                    <span class="text-slate-500 italic">${f.operator}</span>
                    <span class="text-slate-800 font-medium ml-1">"${f.value}"</span>
                    <button onclick="removeFilter('${f.id}')" class="ml-2 p-0.5 hover:bg-indigo-200 rounded-full text-indigo-400 hover:text-indigo-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                container.appendChild(badge);
            });

            noMsg.style.display = filters.length ? 'none' : 'block';
            count.innerText = filters.length;
            applyFilters();
        }

        function renderLogs(filteredData) {
            const tbody = document.getElementById('logBody');
            const empty = document.getElementById('emptyState');
            tbody.innerHTML = '';

            document.getElementById('statTotal').innerText = logs.length;
            document.getElementById('statFiltered').innerText = filteredData.length;

            if (filteredData.length === 0 && logs.length > 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
            }

            filteredData.forEach(log => {
                const tr = document.createElement('tr');
                tr.className = 'log-row transition-colors';
                
                const lvlClass = `status-${log.level.toLowerCase()}`;
                
                tr.innerHTML = `
                    <td class="px-6 py-3 text-slate-400 whitespace-nowrap">${log.timestamp}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="px-2 py-0.5 rounded text-[10px] font-bold ${lvlClass}">${log.level}</span>
                    </td>
                    <td class="px-4 py-3 font-medium text-slate-500">${log.service}</td>
                    <td class="px-6 py-3 text-slate-800 break-all">${highlightMatches(log.message)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function highlightMatches(text) {
            if (!filters.length) return text;
            // Simple visual highlight for active filter values in message field
            let result = text;
            filters.forEach(f => {
                if (f.field === 'message' || f.field === 'any') {
                    const regex = new RegExp(`(${f.value})`, 'gi');
                    result = result.replace(regex, '<mark class="bg-yellow-100 text-yellow-800 px-0.5 rounded">$1</mark>');
                }
            });
            return result;
        }

        // --- Core Filter Logic ---
        function applyFilters() {
            if (filters.length === 0) {
                renderLogs(logs);
                return;
            }

            const filtered = logs.filter(log => {
                const results = filters.map(f => {
                    const targetValue = String(log[f.field]).toLowerCase();
                    const searchValue = f.value.toLowerCase();

                    switch(f.operator) {
                        case 'equals': return targetValue === searchValue;
                        case 'contains': return targetValue.includes(searchValue);
                        case 'startswith': return targetValue.startsWith(searchValue);
                        case 'endswith': return targetValue.endsWith(searchValue);
                        default: return true;
                    }
                });

                return currentLogic === 'AND' 
                    ? results.every(r => r === true)
                    : results.some(r => r === true);
            });

            renderLogs(filtered);
        }

        function addFilter() {
            // In a real app, this would show a nice modal. 
            // For simplicity and richness, we'll use a prompt-like flow or just add a default and let them edit
            const field = prompt("Field (level, service, message):")?.toLowerCase() || 'message';
            if (!['level', 'service', 'message'].includes(field)) return;
            
            const operator = prompt("Operator (contains, equals, startswith, endswith):")?.toLowerCase() || 'contains';
            const value = prompt("Value to filter by:");
            
            if (value) {
                filters.push({
                    id: Date.now().toString(),
                    field,
                    operator,
                    value
                });
                renderFilters();
            }
        }

        function removeFilter(id) {
            filters = filters.filter(f => f.id !== id);
            renderFilters();
        }

        function setLogic(logic) {
            currentLogic = logic;
            const andBtn = document.getElementById('logicAnd');
            const orBtn = document.getElementById('logicOr');
            
            if (logic === 'AND') {
                andBtn.className = 'px-3 py-1 text-xs font-bold rounded-md transition-all bg-white shadow-sm text-indigo-600';
                orBtn.className = 'px-3 py-1 text-xs font-bold rounded-md transition-all text-slate-500';
            } else {
                orBtn.className = 'px-3 py-1 text-xs font-bold rounded-md transition-all bg-white shadow-sm text-indigo-600';
                andBtn.className = 'px-3 py-1 text-xs font-bold rounded-md transition-all text-slate-500';
            }
            applyFilters();
        }

        function resetFilters() {
            filters = [];
            renderFilters();
        }

        // --- Event Listeners ---
        document.getElementById('generateBtn').addEventListener('click', () => {
            for(let i=0; i<15; i++) logs.unshift(generateLog());
            applyFilters();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            logs = [];
            applyFilters();
        });

        document.getElementById('addFilterBtn').addEventListener('click', addFilter);

        // --- Init ---
        // Seed with some initial data
        window.onload = () => {
            for(let i=0; i<25; i++) logs.push(generateLog());
            applyFilters();
        };
    </script>
</body>
</html>