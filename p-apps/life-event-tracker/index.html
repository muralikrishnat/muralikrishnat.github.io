<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chronos - Life Event Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      color: #f8fafc;
      overflow-x: hidden;
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      border-radius: 1.5rem;
    }

    .glass-dark {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .timeline-wheel {
      position: relative;
      padding-left: 2rem;
      border-left: 2px dashed rgba(255, 255, 255, 0.2);
    }

    .timeline-item {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      opacity: 0;
      transform: translateX(-20px);
    }

    .timeline-item.visible {
      opacity: 1;
      transform: translateX(0);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .day-cell {
      aspect-ratio: 1;
      transition: all 0.2s ease;
    }

    .day-cell:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .event-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #60a5fa;
      box-shadow: 0 0 8px #60a5fa;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade {
      animation: fadeIn 0.5s ease-out forwards;
    }

    .active-tab {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }

    input:focus,
    select:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }

    .recurrence-badge {
      font-size: 0.65rem;
      padding: 2px 6px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      text-transform: uppercase;
    }
  </style>
</head>

<body class="p-4 md:p-8">

  <div class="max-w-5xl mx-auto space-y-8">
    <!-- Header -->
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 animate-fade">
      <div>
        <h1 class="text-4xl font-bold tracking-tight text-white flex items-center gap-3">
          <i data-lucide="sparkles" class="text-blue-400"></i>
          Chronos
        </h1>
        <p class="text-slate-400 mt-1">Life tracking, automated.</p>
      </div>

      <div class="flex items-center gap-2 glass p-1">
        <button id="calendarViewBtn" onclick="setView('calendar')"
          class="flex items-center gap-2 px-6 py-2 rounded-xl transition-all active-tab">
          <i data-lucide="calendar" class="w-4 h-4"></i>
          Calendar
        </button>
        <button id="timelineViewBtn" onclick="setView('timeline')"
          class="flex items-center gap-2 px-6 py-2 rounded-xl transition-all">
          <i data-lucide="layout-list" class="w-4 h-4"></i>
          Timeline
        </button>
      </div>
    </header>

    <!-- Main Dashboard -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

      <!-- Form Section (4 cols) -->
      <aside class="lg:col-span-4 space-y-6 animate-fade" style="animation-delay: 0.1s;">
        <div class="glass p-6">
          <h2 class="text-xl font-semibold mb-6 flex items-center gap-2">
            <i data-lucide="plus-circle" class="text-blue-400"></i>
            Event Details
          </h2>
          <form id="eventForm" class="space-y-4">
            <input type="hidden" id="editId">

            <div>
              <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">Event Title</label>
              <input type="text" id="eventTitle" placeholder="Rent, Gym, Birthday..." required
                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">Start Date</label>
                <input type="date" id="startDate" required
                  class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">End Date
                  (Opt)</label>
                <input type="date" id="endDate"
                  class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">Category</label>
                <select id="eventCategory"
                  class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
                  <option value="personal">Personal</option>
                  <option value="financial">Financial</option>
                  <option value="travel">Travel</option>
                  <option value="celebration">Celebration</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">Recurrence</label>
                <select id="recurrence"
                  class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
                  <option value="none">Once</option>
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="yearly">Yearly</option>
                </select>
              </div>
            </div>

            <button type="submit" id="submitBtn"
              class="w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-3 rounded-xl transition-all shadow-lg shadow-blue-900/20 mt-4">
              Save Event
            </button>
            <button type="button" id="cancelBtn" onclick="resetForm()"
              class="hidden w-full text-slate-400 py-2 hover:text-white transition-colors">
              Cancel Editing
            </button>
          </form>
        </div>

        <div class="glass-dark p-6 rounded-3xl">
          <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-widest mb-4">Quick Stats</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="p-4 rounded-2xl bg-white/5 border border-white/5">
              <p class="text-xs text-slate-400 mb-1">Total</p>
              <p id="statTotal" class="text-2xl font-bold">0</p>
            </div>
            <div class="p-4 rounded-2xl bg-white/5 border border-white/5">
              <p class="text-xs text-slate-400 mb-1">Upcoming</p>
              <p id="statUpcoming" class="text-2xl font-bold text-green-400">0</p>
            </div>
          </div>
        </div>
      </aside>

      <!-- Content Section (8 cols) -->
      <main class="lg:col-span-8 space-y-6">

        <!-- Calendar View -->
        <div id="calendarView" class="glass p-6 min-h-[600px] animate-fade" style="animation-delay: 0.2s;">
          <div class="flex items-center justify-between mb-8">
            <div>
              <h2 id="calendarMonth" class="text-2xl font-bold">Month Year</h2>
              <p class="text-xs text-slate-400 mt-1">Recursions included</p>
            </div>
            <div class="flex gap-2">
              <button onclick="changeMonth(-1)" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                <i data-lucide="chevron-left"></i>
              </button>
              <button onclick="todayView()"
                class="px-4 py-1 text-sm bg-white/5 hover:bg-white/10 rounded-lg transition-colors border border-white/10">Today</button>
              <button onclick="changeMonth(1)" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                <i data-lucide="chevron-right"></i>
              </button>
            </div>
          </div>

          <div class="calendar-grid mb-2">
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Sun</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Mon</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Tue</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Wed</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Thu</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Fri</div>
            <div class="text-center text-xs font-bold text-slate-500 uppercase">Sat</div>
          </div>
          <div id="calendarDays" class="calendar-grid"></div>
        </div>

        <!-- Timeline View -->
        <div id="timelineView" class="hidden glass p-6 min-h-[600px] animate-fade">
          <div class="mb-8 flex justify-between items-end">
            <div>
              <h2 class="text-2xl font-bold">Event Timeline</h2>
              <p class="text-slate-400">Next 60 days of occurrences</p>
            </div>
          </div>
          <div id="timelineList" class="timeline-wheel space-y-8 pb-20"></div>
        </div>

      </main>
    </div>
  </div>

  <!-- Notification system -->
  <div id="toast"
    class="fixed bottom-8 right-8 px-6 py-3 rounded-2xl glass-dark border border-white/20 transform translate-y-24 transition-transform duration-300 pointer-events-none z-50">
    <span id="toastMsg" class="text-sm font-medium"></span>
  </div>

  <script>
    // State
    let events = JSON.parse(localStorage.getItem('chronos_v2_events')) || [];
    let currentView = 'calendar';
    let displayDate = new Date();
    const categories = {
      personal: { icon: 'user', color: 'blue' },
      travel: { icon: 'plane', color: 'emerald' },
      financial: { icon: 'credit-card', color: 'amber' },
      celebration: { icon: 'party-popper', color: 'purple' }
    };

    // Utility to generate occurrences within a range
    function getOccurrences(event, startRange, endRange) {
      const occurrences = [];
      const start = new Date(event.startDate);
      const end = event.endDate ? new Date(event.endDate) : new Date(2100, 0, 1);
      const recur = event.recurrence || 'none';

      let current = new Date(start);

      // Limit generation to prevent infinite loops or heavy processing
      const maxOccurrences = 366;
      let count = 0;

      while (current <= end && current <= endRange && count < maxOccurrences) {
        if (current >= startRange) {
          occurrences.push({
            ...event,
            date: current.toISOString().split('T')[0],
            isRecursion: current.toISOString().split('T')[0] !== event.startDate
          });
        }

        if (recur === 'none') break;

        if (recur === 'daily') current.setDate(current.getDate() + 1);
        else if (recur === 'weekly') current.setDate(current.getDate() + 7);
        else if (recur === 'monthly') current.setMonth(current.getMonth() + 1);
        else if (recur === 'yearly') current.setFullYear(current.getFullYear() + 1);

        count++;
      }
      return occurrences;
    }

    function initIcons() {
      lucide.createIcons();
    }

    function setView(view) {
      currentView = view;
      document.getElementById('calendarView').classList.toggle('hidden', view !== 'calendar');
      document.getElementById('timelineView').classList.toggle('hidden', view !== 'timeline');
      document.getElementById('calendarViewBtn').classList.toggle('active-tab', view === 'calendar');
      document.getElementById('timelineViewBtn').classList.toggle('active-tab', view === 'timeline');
      render();
    }

    document.getElementById('eventForm').onsubmit = (e) => {
      e.preventDefault();
      const id = document.getElementById('editId').value;
      const newEvent = {
        id: id || Date.now().toString(),
        title: document.getElementById('eventTitle').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value || null,
        category: document.getElementById('eventCategory').value,
        recurrence: document.getElementById('recurrence').value
      };

      if (id) {
        events = events.map(ev => ev.id === id ? newEvent : ev);
      } else {
        events.push(newEvent);
      }

      saveAndRender('Event saved successfully!');
      resetForm();
    };

    function deleteEvent(id) {
      events = events.filter(ev => ev.id !== id);
      saveAndRender('Event removed');
    }

    function editEvent(id) {
      const ev = events.find(e => e.id === id);
      if (!ev) return;

      document.getElementById('editId').value = ev.id;
      document.getElementById('eventTitle').value = ev.title;
      document.getElementById('startDate').value = ev.startDate;
      document.getElementById('endDate').value = ev.endDate || '';
      document.getElementById('eventCategory').value = ev.category;
      document.getElementById('recurrence').value = ev.recurrence;

      document.getElementById('submitBtn').innerText = 'Update Event';
      document.getElementById('cancelBtn').classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetForm() {
      document.getElementById('eventForm').reset();
      document.getElementById('editId').value = '';
      document.getElementById('submitBtn').innerText = 'Save Event';
      document.getElementById('cancelBtn').classList.add('hidden');
    }

    function saveAndRender(msg) {
      localStorage.setItem('chronos_v2_events', JSON.stringify(events));
      showToast(msg);
      render();
    }

    function render() {
      renderStats();
      if (currentView === 'calendar') renderCalendar();
      else renderTimeline();
      initIcons();
    }

    function renderStats() {
      const today = new Date().setHours(0, 0, 0, 0);
      document.getElementById('statTotal').innerText = events.length;
      // For simple stats, just count raw event objects that haven't ended
      document.getElementById('statUpcoming').innerText = events.filter(e => !e.endDate || new Date(e.endDate) >= today).length;
    }

    function changeMonth(delta) {
      displayDate.setMonth(displayDate.getMonth() + delta);
      renderCalendar();
    }

    function todayView() {
      displayDate = new Date();
      renderCalendar();
    }

    function renderCalendar() {
      const year = displayDate.getFullYear();
      const month = displayDate.getMonth();
      const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      document.getElementById('calendarMonth').innerText = `${monthNames[month]} ${year}`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const container = document.getElementById('calendarDays');
      container.innerHTML = '';

      const rangeStart = new Date(year, month, 1);
      const rangeEnd = new Date(year, month, daysInMonth);

      // Fetch all occurrences for this month
      let monthOccurrences = [];
      events.forEach(ev => {
        monthOccurrences = monthOccurrences.concat(getOccurrences(ev, rangeStart, rangeEnd));
      });

      for (let i = 0; i < firstDay; i++) {
        container.innerHTML += `<div class="day-cell opacity-0"></div>`;
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayOccurrences = monthOccurrences.filter(o => o.date === dateStr);
        const isToday = new Date().toISOString().split('T')[0] === dateStr;

        const cell = document.createElement('div');
        cell.className = `day-cell relative flex flex-col items-center justify-center p-2 rounded-xl text-sm cursor-pointer border ${isToday ? 'bg-blue-600/20 border-blue-500/50' : 'bg-white/5 border-transparent'}`;
        cell.innerHTML = `
                    <span class="${isToday ? 'font-bold text-white' : 'text-slate-400'}">${day}</span>
                    <div class="flex flex-wrap justify-center gap-1 mt-1 max-w-full">
                        ${dayOccurrences.map(o => `<div class="event-dot" title="${o.title}"></div>`).join('')}
                    </div>
                `;

        if (dayOccurrences.length > 0) {
          cell.onclick = () => {
            showToast(`${dayOccurrences.length} event(s) today`);
            // Optional: show mini modal or switch to timeline
          };
        }

        container.appendChild(cell);
      }
    }

    function renderTimeline() {
      const list = document.getElementById('timelineList');
      const today = new Date().setHours(0, 0, 0, 0);
      const horizon = new Date();
      horizon.setDate(horizon.getDate() + 60); // Show next 60 days

      let allUpcoming = [];
      events.forEach(ev => {
        allUpcoming = allUpcoming.concat(getOccurrences(ev, new Date(today), horizon));
      });

      // Add past events (actual start dates only) to show history if wanted
      // For now, let's just show the timeline of the next 60 days of occurrences
      allUpcoming.sort((a, b) => new Date(a.date) - new Date(b.date));

      if (allUpcoming.length === 0) {
        list.innerHTML = `<div class="text-slate-500 py-20 text-center">No upcoming events in the next 60 days.</div>`;
        return;
      }

      list.innerHTML = allUpcoming.map((occ, index) => {
        const occDate = new Date(occ.date);
        const diffTime = occDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const cat = categories[occ.category] || categories.personal;

        let countdownText = diffDays === 0 ? 'Today' : `${diffDays} days to go`;

        return `
                    <div class="timeline-item visible glass p-5 relative" style="transition-delay: ${index * 0.03}s">
                        <div class="absolute -left-[2.75rem] top-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-slate-900 border-2 border-${cat.color}-500 flex items-center justify-center">
                            <div class="w-1.5 h-1.5 rounded-full bg-${cat.color}-400"></div>
                        </div>
                        
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl bg-${cat.color}-500/20 flex items-center justify-center text-${cat.color}-400">
                                    <i data-lucide="${cat.icon}"></i>
                                </div>
                                <div>
                                    <div class="flex items-center gap-2">
                                        <h3 class="font-bold text-lg text-white">${occ.title}</h3>
                                        ${occ.recurrence !== 'none' ? `<span class="recurrence-badge text-blue-400 border border-blue-500/30"><i data-lucide="repeat" class="w-2 h-2 inline mr-1"></i>${occ.recurrence}</span>` : ''}
                                    </div>
                                    <div class="flex items-center gap-3 text-sm text-slate-400">
                                        <span class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3"></i>
                                            ${occDate.toLocaleDateString(undefined, { dateStyle: 'long' })}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between w-full md:w-auto gap-6">
                                <div class="text-left md:text-right">
                                    <p class="text-lg font-bold text-white">${countdownText}</p>
                                    <p class="text-[10px] uppercase font-bold tracking-wider text-slate-500">${occ.category}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="editEvent('${occ.id}')" class="p-2 hover:bg-white/10 rounded-xl text-slate-400 hover:text-white transition-all">
                                        <i data-lucide="edit-3" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="deleteEvent('${occ.id}')" class="p-2 hover:bg-red-500/10 rounded-xl text-slate-400 hover:text-red-400 transition-all">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
      }).join('');
      initIcons();
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      document.getElementById('toastMsg').innerText = msg;
      toast.style.transform = 'translateY(0)';
      setTimeout(() => {
        toast.style.transform = 'translateY(6rem)';
      }, 3000);
    }

    window.onload = render;
  </script>
</body>

</html>