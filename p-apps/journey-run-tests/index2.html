<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JourneyMapper Pro - Advanced Test Flows</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        glass: 'rgba(15, 23, 42, 0.8)',
                        action: '#3b82f6',
                        debug: '#a855f7',
                        condition: '#f59e0b',
                        success: '#10b981',
                        error: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap');

        body {
            background-color: #020617;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            touch-action: none;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .node {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }

        .node:hover {
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .node-selected {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        #world {
            position: absolute;
            width: 5000px;
            height: 5000px;
            background-size: 60px 60px;
            background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
            transform-origin: 0 0;
        }

        svg#connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .path {
            fill: none;
            stroke-width: 2.5px;
            stroke: rgba(255,255,255,0.15);
            transition: stroke 0.4s, stroke-width 0.3s;
        }

        .path-active {
            stroke: #3b82f6;
            stroke-width: 4px;
            stroke-dasharray: 10, 10;
            animation: flow 1s linear infinite;
        }

        @keyframes flow { to { stroke-dashoffset: -20; } }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .status-pulse::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0; left: 0;
            border-radius: inherit;
            border: 2px solid currentColor;
            animation: pulse-ring 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body>

    <!-- Header UI -->
    <nav class="fixed top-0 left-0 w-full z-50 p-4 pointer-events-none">
        <div class="glass-panel max-w-5xl mx-auto rounded-full px-6 py-3 flex items-center justify-between pointer-events-auto">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center font-bold shadow-lg shadow-blue-500/20">JP</div>
                <div>
                    <h1 class="font-bold text-sm tracking-tight">JourneyMapper <span class="text-blue-400">PRO</span></h1>
                    <p class="text-[10px] text-gray-500 font-medium">Automated Test Architect</p>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <div class="hidden md:flex gap-4 border-r border-white/10 pr-6 mr-2">
                    <div class="text-center">
                        <div class="text-[9px] text-gray-500 uppercase font-bold tracking-widest">Health</div>
                        <div id="stat-health" class="text-emerald-400 font-bold text-sm">--%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-[9px] text-gray-500 uppercase font-bold tracking-widest">Nodes</div>
                        <div id="stat-nodes" class="text-white font-bold text-sm">0</div>
                    </div>
                </div>
                <button id="run-btn" onclick="executeSequence()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-full text-xs font-bold transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2 active:scale-95">
                    <span id="run-icon">üöÄ</span> Execute Journey
                </button>
            </div>
        </div>
    </nav>

    <!-- Canvas -->
    <div id="viewport" class="w-screen h-screen overflow-hidden bg-slate-950">
        <div id="world">
            <svg id="connections"></svg>
            <div id="nodes-layer" class="relative w-full h-full"></div>
        </div>
    </div>

    <!-- Side Inspector -->
    <aside id="inspector" class="fixed top-24 right-4 bottom-4 w-[calc(100vw-32px)] md:w-96 glass-panel rounded-3xl p-6 z-50 translate-x-[120%] transition-transform duration-500 ease-in-out flex flex-col">
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-2">
                <div id="inspect-icon" class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-lg"></div>
                <h2 class="text-lg font-bold">Node Inspector</h2>
            </div>
            <button onclick="closeInspector()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">‚úï</button>
        </div>
        
        <div id="inspect-content" class="flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-6">
            <!-- Content Injected -->
        </div>
    </aside>

    <script>
        const NODE_TYPES = {
            PAGE: { color: 'text-blue-400', bg: 'bg-blue-500/10', icon: 'üìÑ' },
            ACTION: { color: 'text-purple-400', bg: 'bg-purple-500/10', icon: '‚ö°' },
            DEBUG: { color: 'text-indigo-400', bg: 'bg-indigo-500/10', icon: 'üîç' },
            CONDITION: { color: 'text-amber-400', bg: 'bg-amber-500/10', icon: '‚öñÔ∏è' },
            SYSTEM: { color: 'text-emerald-400', bg: 'bg-emerald-500/10', icon: '‚öôÔ∏è' }
        };

        const state = {
            nodes: [
                { id: 'n1', label: 'Login Screen', type: 'PAGE', x: 200, y: 300, icon: 'üè†', details: 'Initial URL: /auth/login' },
                { id: 'n2', label: 'Fill Email', type: 'ACTION', x: 450, y: 300, icon: '‚å®Ô∏è', action: 'Input Field', selector: '#email' },
                { id: 'n3', label: 'Check API Auth', type: 'DEBUG', x: 700, y: 300, icon: 'üì°', check: 'Network Call', target: '/api/v1/pre-auth' },
                { id: 'n4', label: 'Toggle Remember', type: 'ACTION', x: 950, y: 200, icon: 'üîò', action: 'Checkbox' },
                { id: 'n5', label: 'Click Submit', type: 'ACTION', x: 950, y: 400, icon: 'üñ±Ô∏è', action: 'Click Element' },
                { id: 'n6', label: 'Console Audit', type: 'DEBUG', x: 1200, y: 300, icon: '‚ö†Ô∏è', check: 'Console Errors' },
                { id: 'n7', label: 'Is Logged In?', type: 'CONDITION', x: 1450, y: 300, icon: '‚ùì', check: 'Condition' },
                { id: 'n8', label: 'Dashboard', type: 'PAGE', x: 1750, y: 200, icon: 'üìä', details: 'Target: /home' },
                { id: 'n9', label: 'Capture Screen', type: 'SYSTEM', x: 1750, y: 400, icon: 'üì∏', action: 'Screenshot' },
                { id: 'n10', label: 'Analyze Performance', type: 'DEBUG', x: 2050, y: 300, icon: '‚è±Ô∏è', check: 'Page Size' }
            ],
            edges: [
                { id: 'e1', from: 'n1', to: 'n2' }, { id: 'e2', from: 'n2', to: 'n3' },
                { id: 'e3', from: 'n3', to: 'n4' }, { id: 'e4', from: 'n3', to: 'n5' },
                { id: 'e5', from: 'n4', to: 'n6' }, { id: 'e6', from: 'n5', to: 'n6' },
                { id: 'e7', from: 'n6', to: 'n7' }, { id: 'e8', from: 'n7', to: 'n8' },
                { id: 'e9', from: 'n7', to: 'n9' }, { id: 'ea', from: 'n8', to: 'n10' }
            ],
            pan: { x: 50, y: 50 },
            isPanning: false,
            activeNodeId: null,
            executing: false,
            activePaths: new Set(),
            completedNodes: new Set()
        };

        const nodesLayer = document.getElementById('nodes-layer');
        const svgLayer = document.getElementById('connections');
        const world = document.getElementById('world');

        function init() {
            render();
            setupPanning();
            updateStats();
        }

        function render() {
            nodesLayer.innerHTML = '';
            state.nodes.forEach(node => {
                const config = NODE_TYPES[node.type];
                const isComplete = state.completedNodes.has(node.id);
                
                const div = document.createElement('div');
                div.className = `node absolute w-52 p-4 rounded-2xl cursor-pointer ${state.activeNodeId === node.id ? 'node-selected' : ''}`;
                div.style.left = `${node.x}px`;
                div.style.top = `${node.y}px`;
                
                div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-xl ${config.bg} flex items-center justify-center text-xl shadow-inner">${node.icon}</div>
                        <div class="flex-1 overflow-hidden">
                            <div class="text-[9px] font-bold uppercase tracking-widest ${config.color} mb-1">${node.type}</div>
                            <div class="text-sm font-bold truncate text-slate-100">${node.label}</div>
                            <div class="mt-2 flex items-center gap-2">
                                <div class="w-2 h-2 rounded-full ${isComplete ? 'bg-emerald-500 status-pulse' : 'bg-slate-700'}"></div>
                                <span class="text-[9px] text-slate-500 font-mono">${isComplete ? 'PASSED' : 'IDLE'}</span>
                            </div>
                        </div>
                    </div>
                `;
                div.onclick = (e) => { e.stopPropagation(); inspectNode(node); };
                nodesLayer.appendChild(div);
            });

            svgLayer.innerHTML = '';
            state.edges.forEach(edge => {
                const from = state.nodes.find(n => n.id === edge.from);
                const to = state.nodes.find(n => n.id === edge.to);
                if (!from || !to) return;

                const fx = from.x + 208;
                const fy = from.y + 45;
                const tx = to.x;
                const ty = to.y + 45;

                const midX = fx + (tx - fx) / 2;
                const pathD = `M ${fx} ${fy} C ${midX} ${fy}, ${midX} ${ty}, ${tx} ${ty}`;

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", pathD);
                path.setAttribute("class", `path ${state.activePaths.has(edge.id) ? 'path-active' : ''}`);
                svgLayer.appendChild(path);
            });
        }

        function setupPanning() {
            const viewport = document.getElementById('viewport');
            let start = { x: 0, y: 0 };

            const onStart = (e) => {
                state.isPanning = true;
                const x = e.clientX || e.touches[0].clientX;
                const y = e.clientY || e.touches[0].clientY;
                start = { x: x - state.pan.x, y: y - state.pan.y };
                viewport.style.cursor = 'grabbing';
            };

            const onMove = (e) => {
                if (!state.isPanning) return;
                const x = e.clientX || e.touches?.[0].clientX;
                const y = e.clientY || e.touches?.[0].clientY;
                if (x === undefined) return;
                state.pan = { x: x - start.x, y: y - start.y };
                world.style.transform = `translate(${state.pan.x}px, ${state.pan.y}px)`;
            };

            const onEnd = () => {
                state.isPanning = false;
                viewport.style.cursor = 'grab';
            };

            viewport.addEventListener('mousedown', onStart);
            viewport.addEventListener('touchstart', onStart);
            window.addEventListener('mousemove', onMove);
            window.addEventListener('touchmove', onMove);
            window.addEventListener('mouseup', onEnd);
            window.addEventListener('touchend', onEnd);
            
            // Initial positioning
            world.style.transform = `translate(${state.pan.x}px, ${state.pan.y}px)`;
        }

        async function executeSequence() {
            if (state.executing) return;
            state.executing = true;
            state.completedNodes.clear();
            state.activePaths.clear();
            
            const btn = document.getElementById('run-btn');
            btn.innerHTML = `<span>‚è≥</span> Running...`;
            
            // Simulating a breadth-first execution
            const executionOrder = [
                ['n1'], ['n2'], ['n3'], ['n4', 'n5'], ['n6'], ['n7'], ['n8', 'n9'], ['n10']
            ];

            for (const step of executionOrder) {
                // Find edges leading into these nodes
                state.edges.forEach(e => {
                    if (step.includes(e.to) && state.completedNodes.has(e.from)) {
                        state.activePaths.add(e.id);
                    }
                });
                render();
                await new Promise(r => setTimeout(r, 600));

                step.forEach(nId => state.completedNodes.add(nId));
                state.activePaths.clear();
                updateStats();
                render();
                await new Promise(r => setTimeout(r, 400));
            }

            state.executing = false;
            btn.innerHTML = `<span>üöÄ</span> Execute Journey`;
        }

        function updateStats() {
            document.getElementById('stat-nodes').textContent = state.nodes.length;
            const health = Math.round((state.completedNodes.size / state.nodes.length) * 100);
            const el = document.getElementById('stat-health');
            el.textContent = (health || 100) + '%';
        }

        function inspectNode(node) {
            state.activeNodeId = node.id;
            render();

            const panel = document.getElementById('inspector');
            const iconBox = document.getElementById('inspect-icon');
            const content = document.getElementById('inspect-content');
            const config = NODE_TYPES[node.type];

            iconBox.innerHTML = node.icon;
            iconBox.className = `w-12 h-12 rounded-2xl ${config.bg} flex items-center justify-center text-2xl mb-4`;

            let properties = `
                <div>
                    <h3 class="text-2xl font-bold text-white mb-1">${node.label}</h3>
                    <span class="px-2 py-1 rounded-md bg-white/5 text-[10px] font-bold text-slate-400 uppercase tracking-widest">${node.type}</span>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                        <div class="text-[10px] text-slate-500 font-bold uppercase mb-1">Status</div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full ${state.completedNodes.has(node.id) ? 'bg-emerald-500' : 'bg-amber-500'}"></div>
                            <span class="text-xs font-bold">${state.completedNodes.has(node.id) ? 'Passed' : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                        <div class="text-[10px] text-slate-500 font-bold uppercase mb-1">Runtime</div>
                        <div class="text-xs font-bold font-mono">142ms</div>
                    </div>
                </div>
            `;

            if (node.type === 'DEBUG') {
                properties += `
                    <div class="space-y-4">
                        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Debug Parameters</div>
                        <div class="space-y-2">
                            ${generateDebugItem('Check Type', node.check || 'System Audit')}
                            ${generateDebugItem('Target Path', node.target || 'Global Context')}
                            ${generateDebugItem('Network Size', '42.4 KB')}
                            ${generateDebugItem('Transfer Time', '12ms')}
                        </div>
                    </div>
                `;
            } else if (node.type === 'ACTION') {
                properties += `
                    <div class="space-y-4">
                        <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Action Details</div>
                        <div class="space-y-2">
                            ${generateDebugItem('Command', node.action || 'Execute')}
                            ${generateDebugItem('Selector', node.selector || '.btn-primary')}
                            ${generateDebugItem('Force Click', 'True')}
                        </div>
                    </div>
                `;
            }

            properties += `
                <div class="pt-4 border-t border-white/10 space-y-3">
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Audit Log</div>
                    <div class="font-mono text-[10px] bg-black/40 p-3 rounded-xl border border-white/5 text-emerald-400/80 leading-relaxed">
                        [13:42:01] Initializing node context...<br>
                        [13:42:02] Injecting script into target...<br>
                        [13:42:02] Result: 200 OK
                    </div>
                </div>
            `;

            content.innerHTML = properties;
            panel.classList.remove('translate-x-[120%]');
        }

        function generateDebugItem(label, value) {
            return `
                <div class="flex justify-between items-center py-2 border-b border-white/5">
                    <span class="text-xs text-slate-400">${label}</span>
                    <span class="text-xs font-mono font-semibold text-slate-200">${value}</span>
                </div>
            `;
        }

        function closeInspector() {
            document.getElementById('inspector').classList.add('translate-x-[120%]');
            state.activeNodeId = null;
            render();
        }

        init();
    </script>
</body>
</html>