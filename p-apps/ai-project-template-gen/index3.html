<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Data Pipeline - Workflow</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Animated Background Blobs */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(40px, -60px) scale(1.1); }
            66% { transform: translate(-30px, 30px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 8s infinite alternate ease-in-out;
        }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Node States & Animations */
        .node-base {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }
        
        .node-active {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.6) !important;
            color: #60a5fa !important;
            transform: scale(1.15);
            background: rgba(15, 23, 42, 0.9);
        }

        /* Processing Rings for Active Node */
        .node-active::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #60a5fa;
            border-bottom-color: #60a5fa;
            animation: spin 1s linear infinite;
        }
        
        .node-active::after {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            border: 2px dashed rgba(59, 130, 246, 0.4);
            animation: spin-reverse 2s linear infinite;
        }

        /* Pulse the icon when processing */
        .node-active i {
            animation: pulse-icon 1s ease-in-out infinite alternate;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes spin-reverse { 100% { transform: rotate(-360deg); } }
        @keyframes pulse-icon {
            0% { transform: scale(0.9); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; filter: drop-shadow(0 0 8px #60a5fa); }
        }

        .node-complete {
            border-color: #10b981 !important;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3) !important;
            color: #34d399 !important;
        }
        
        .node-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5) !important;
            color: #f87171 !important;
            transform: scale(1.1);
        }

        /* SVG Paths */
        .path-line {
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 4;
            fill: none;
            transition: all 0.2s ease;
            stroke-linecap: round;
        }

        .path-pulsing {
            stroke: #3b82f6;
            stroke-width: 5;
            stroke-dasharray: 12, 12;
            animation: pulse-dash 0.3s linear infinite; /* Faster path animation */
            filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.8));
        }

        .path-complete {
            stroke: #10b981;
            stroke-width: 4;
            stroke-dasharray: none;
            filter: drop-shadow(0 0 4px rgba(16, 185, 129, 0.5));
        }

        @keyframes pulse-dash {
            0% { stroke-dashoffset: 24; }
            100% { stroke-dashoffset: 0; }
        }

        /* Custom Scrollbar for Log */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
    </style>
</head>
<body class="bg-slate-950 min-h-screen text-slate-200 font-sans overflow-hidden relative selection:bg-blue-500/30">
    
    <!-- Background Animated Blobs -->
    <div class="fixed top-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-600/40 rounded-full mix-blend-screen filter blur-[100px] opacity-70 animate-blob pointer-events-none"></div>
    <div class="fixed top-[20%] right-[-10%] w-[400px] h-[400px] bg-blue-600/40 rounded-full mix-blend-screen filter blur-[100px] opacity-70 animate-blob animation-delay-2000 pointer-events-none"></div>
    <div class="fixed bottom-[-20%] left-[20%] w-[600px] h-[600px] bg-violet-800/40 rounded-full mix-blend-screen filter blur-[120px] opacity-70 animate-blob animation-delay-4000 pointer-events-none"></div>

    <div class="relative z-10 h-screen flex flex-col items-center justify-center p-4 md:p-8">
        
        <!-- Main Application Container -->
        <div class="glass-panel w-full max-w-6xl rounded-3xl p-6 md:p-10 flex flex-col gap-8 shadow-2xl">
            
            <!-- Header -->
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold tracking-wide text-white flex items-center gap-3">
                        <i class="fa-solid fa-network-wired text-blue-500"></i>
                        Data Intelligence Pipeline
                    </h1>
                    <p class="text-slate-400 mt-1 text-sm">Automated processing workflow with smart review loop</p>
                </div>
                <button id="start-btn" class="glass px-8 py-3 rounded-full hover:bg-white/10 transition-all text-blue-400 font-bold border border-blue-500/30 hover:border-blue-400 hover:shadow-[0_0_20px_rgba(59,130,246,0.4)] active:scale-95 flex items-center gap-2">
                    <i class="fa-solid fa-play"></i> Initialize Flow
                </button>
            </div>

            <!-- Workflow Canvas Container -->
            <div class="relative w-full h-[400px] glass rounded-2xl flex items-center px-4 sm:px-12 mt-4 z-0">
                <!-- SVG Layer for Paths -->
                <svg id="paths-svg" class="absolute top-0 left-0 w-full h-full -z-10"></svg>

                <!-- Nodes -->
                <div class="w-full flex justify-between items-center relative z-10">
                    
                    <!-- Node 1 -->
                    <div class="relative flex flex-col items-center group" id="node-1">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                        </div>
                        <div class="absolute top-full mt-4 text-center">
                            <span class="block font-semibold text-slate-200 text-sm">Ingest</span>
                            <span class="block text-xs text-slate-500 mt-1 w-20">Raw Data</span>
                        </div>
                    </div>

                    <!-- Node 2 -->
                    <div class="relative flex flex-col items-center group" id="node-2">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800">
                            <i class="fa-solid fa-file-code"></i>
                        </div>
                        <div class="absolute top-full mt-4 text-center">
                            <span class="block font-semibold text-slate-200 text-sm">Parse</span>
                            <span class="block text-xs text-slate-500 mt-1 w-20">Extraction</span>
                        </div>
                    </div>

                    <!-- Node 3 -->
                    <div class="relative flex flex-col items-center group" id="node-3">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800">
                            <i class="fa-solid fa-microchip"></i>
                        </div>
                        <div class="absolute top-full mt-4 text-center">
                            <span class="block font-semibold text-slate-200 text-sm">Analyze</span>
                            <span class="block text-xs text-slate-500 mt-1 w-20">AI Inference</span>
                        </div>
                    </div>

                    <!-- Node 4 -->
                    <div class="relative flex flex-col items-center group" id="node-4">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800">
                            <i class="fa-solid fa-clipboard-check"></i>
                        </div>
                        <div class="absolute top-full mt-4 text-center">
                            <span class="block font-semibold text-slate-200 text-sm">Review</span>
                            <span class="block text-xs text-slate-500 mt-1 w-24">Confidence Check</span>
                        </div>
                    </div>

                    <!-- Node 5 -->
                    <div class="relative flex flex-col items-center group" id="node-5">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800">
                            <i class="fa-solid fa-rocket"></i>
                        </div>
                        <div class="absolute top-full mt-4 text-center">
                            <span class="block font-semibold text-slate-200 text-sm">Publish</span>
                            <span class="block text-xs text-slate-500 mt-1 w-20">Production</span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Status Log Panel -->
            <div class="glass rounded-2xl p-5 h-[180px] flex flex-col">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-terminal text-slate-500"></i> Execution Log
                </h3>
                <div id="log-content" class="flex-1 overflow-y-auto font-mono text-sm flex flex-col gap-1.5 pr-2">
                    <div class="text-slate-500">System idle. Ready to process.</div>
                </div>
            </div>

        </div>
    </div>

    <!-- Application Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const svg = document.getElementById('paths-svg');
            const logContent = document.getElementById('log-content');
            const startBtn = document.getElementById('start-btn');
            
            // Define topology
            const topology = [
                { id: '1-2', from: 1, to: 2 },
                { id: '2-3', from: 2, to: 3 },
                { id: '3-4', from: 3, to: 4 },
                { id: '4-5', from: 4, to: 5 },
                { id: '4-3-loop', from: 4, to: 3, isLoop: true }
            ];

            // State management
            let pathStates = {}; // '1-2': 'completed', '4-3-loop': 'pulsing'
            let isRunning = false;

            // Utilities
            const delay = (ms) => new Promise(res => setTimeout(res, ms));
            
            function getTimestamp() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}.${now.getMilliseconds().toString().padStart(3, '0')}`;
            }

            function log(message, type = 'info') {
                const div = document.createElement('div');
                div.className = 'flex gap-3 animate-[fade-in_0.3s_ease-out]';
                
                let colorClass = 'text-slate-300';
                if(type === 'success') colorClass = 'text-emerald-400 font-semibold';
                if(type === 'warning') colorClass = 'text-amber-400';
                if(type === 'error') colorClass = 'text-rose-400 font-semibold';
                if(type === 'action') colorClass = 'text-blue-300';

                div.innerHTML = `
                    <span class="text-slate-600 shrink-0">[${getTimestamp()}]</span>
                    <span class="${colorClass}">${message}</span>
                `;
                logContent.appendChild(div);
                logContent.scrollTop = logContent.scrollHeight;
            }

            // Draw SVG Paths
            function drawPaths() {
                svg.innerHTML = ''; // Clear existing
                
                // Add marker definition for arrows
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                const states = ['default', 'pulsing', 'complete'];
                const colors = { default: 'rgba(255,255,255,0.1)', pulsing: '#3b82f6', complete: '#10b981' };
                
                states.forEach(state => {
                    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                    marker.setAttribute('id', `arrow-${state}`);
                    marker.setAttribute('viewBox', '0 0 10 10');
                    marker.setAttribute('refX', '8');
                    marker.setAttribute('refY', '5');
                    marker.setAttribute('markerWidth', '6');
                    marker.setAttribute('markerHeight', '6');
                    marker.setAttribute('orient', 'auto-start-reverse');
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', 'M 0 0 L 10 5 L 0 10 z');
                    path.setAttribute('fill', colors[state]);
                    marker.appendChild(path);
                    defs.appendChild(marker);
                });
                svg.appendChild(defs);

                const containerRect = svg.parentElement.getBoundingClientRect();
                const nodeRadius = 32; // Half of w-16

                topology.forEach(conn => {
                    const elFrom = document.getElementById(`node-${conn.from}`);
                    const elTo = document.getElementById(`node-${conn.to}`);
                    
                    if (!elFrom || !elTo) return;

                    const rectFrom = elFrom.getBoundingClientRect();
                    const rectTo = elTo.getBoundingClientRect();

                    const centerX1 = (rectFrom.left - containerRect.left) + (rectFrom.width / 2);
                    const centerY1 = (rectFrom.top - containerRect.top) + (rectFrom.height / 2);
                    
                    const centerX2 = (rectTo.left - containerRect.left) + (rectTo.width / 2);
                    const centerY2 = (rectTo.top - containerRect.top) + (rectTo.height / 2);

                    const pathEl = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    pathEl.setAttribute('id', `path-${conn.id}`);
                    
                    let d = '';
                    if (conn.isLoop) {
                        // Loop path: Drop down from center bottom, curve backwards, come up center bottom
                        const dropHeight = 90;
                        const startX = centerX1;
                        const startY = centerY1 + nodeRadius;
                        const endX = centerX2;
                        const endY = centerY2 + nodeRadius;
                        
                        d = `M ${startX},${startY} C ${startX},${startY + dropHeight} ${endX},${endY + dropHeight} ${endX},${endY + 6}`;
                    } else {
                        // Forward path: right edge to left edge
                        const startX = centerX1 + nodeRadius;
                        const startY = centerY1;
                        const endX = centerX2 - nodeRadius - 6; // Leave space for arrow
                        const endY = centerY2;
                        d = `M ${startX},${startY} L ${endX},${endY}`;
                    }

                    pathEl.setAttribute('d', d);
                    
                    // Apply current state
                    const state = pathStates[conn.id] || 'default';
                    let className = 'path-line';
                    if (state === 'pulsing') className += ' path-pulsing';
                    if (state === 'completed') className += ' path-complete';
                    
                    pathEl.setAttribute('class', className);
                    
                    // Add arrow head
                    const arrowState = state === 'completed' ? 'complete' : (state === 'pulsing' ? 'pulsing' : 'default');
                    pathEl.setAttribute('marker-end', `url(#arrow-${arrowState})`);

                    svg.appendChild(pathEl);
                });
            }

            // Window resize handler to redraw SVGs correctly
            window.addEventListener('resize', drawPaths);
            
            // Initialization
            drawPaths();

            // Flow Control functions
            function resetAll() {
                pathStates = {};
                for (let i = 1; i <= 5; i++) {
                    const n = document.getElementById(`node-${i}`);
                    n.firstElementChild.className = 'w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800';
                }
                drawPaths();
                logContent.innerHTML = '';
            }

            function setNodeState(nodeId, state) {
                const nodeOuter = document.getElementById(`node-${nodeId}`).firstElementChild;
                nodeOuter.className = 'w-16 h-16 rounded-full flex items-center justify-center node-base text-2xl z-10 relative bg-slate-800';
                if (state === 'active') nodeOuter.classList.add('node-active');
                if (state === 'complete') nodeOuter.classList.add('node-complete');
                if (state === 'error') nodeOuter.classList.add('node-error');
            }

            async function animatePath(pathId, duration) {
                pathStates[pathId] = 'pulsing';
                drawPaths();
                
                await delay(duration);
                
                pathStates[pathId] = 'completed';
                drawPaths();
            }

            // Core Simulation Logic
            async function executePipeline() {
                if (isRunning) return;
                isRunning = true;
                startBtn.disabled = true;
                startBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
                startBtn.classList.replace('text-blue-400', 'text-slate-400');
                
                resetAll();
                log("Initializing Data Pipeline Architecture...", "action");
                await delay(600);

                // Timing Constants
                const NODE_TIME = 1200; // Time spent spinning on node
                const PATH_TIME = 200;  // Extremely fast path transit

                // --- NODE 1: Ingest ---
                setNodeState(1, 'active');
                log("Connecting to data source stream...");
                await delay(NODE_TIME);
                log("Payload received (2.4MB).", "success");
                setNodeState(1, 'complete');
                
                log("Transmitting data to Parser...");
                await animatePath('1-2', PATH_TIME);

                // --- NODE 2: Parse ---
                setNodeState(2, 'active');
                log("Extracting text features and metadata...");
                await delay(NODE_TIME);
                log("Parsing complete. Tokens generated.", "success");
                setNodeState(2, 'complete');

                log("Forwarding normalized data to Analysis Engine...");
                await animatePath('2-3', PATH_TIME);

                let reviewPassed = false;
                let loopCount = 0;

                while(!reviewPassed) {
                    // --- NODE 3: Analyze ---
                    setNodeState(3, 'active');
                    log(`Running ML inference model (Iter: ${loopCount + 1})...`);
                    await delay(NODE_TIME);
                    log("Analysis task yielded confidence score.", "success");
                    setNodeState(3, 'complete');

                    log("Sending payload for Quality Review...");
                    await animatePath('3-4', PATH_TIME);

                    // --- NODE 4: Review ---
                    setNodeState(4, 'active');
                    log("Evaluating thresholds...");
                    await delay(NODE_TIME);

                    // Logic: 50% chance to fail, but never fail more than twice.
                    let score = Math.random();
                    if (score > 0.5 || loopCount >= 2) {
                        reviewPassed = true;
                        log(`Review passed! Confidence score acceptable (${(0.85 + (score*0.14)).toFixed(2)}).`, "success");
                        setNodeState(4, 'complete');
                        
                        log("Pushing validated data to Production...");
                        await animatePath('4-5', PATH_TIME);
                    } else {
                        loopCount++;
                        log(`Review Failed. Low confidence (${(0.4 + (score*0.3)).toFixed(2)}). Anomaly detected.`, "warning");
                        setNodeState(4, 'error');
                        await delay(800); // Briefly show error state
                        
                        log("Looping data back to Analysis Engine for recalibration.", "error");
                        await animatePath('4-3-loop', PATH_TIME);
                        
                        // Visual reset for the loop nodes
                        setNodeState(3, 'base');
                        setNodeState(4, 'base');
                        // Reset forward path for next iteration
                        pathStates['3-4'] = 'default';
                        pathStates['4-3-loop'] = 'default';
                        drawPaths();
                    }
                }

                // --- NODE 5: Publish ---
                setNodeState(5, 'active');
                log("Executing database commit and broadcasting event...");
                await delay(NODE_TIME);
                setNodeState(5, 'complete');
                
                log("Pipeline execution successfully concluded.", "success");

                // Finish
                isRunning = false;
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Rerun Workflow';
                startBtn.classList.replace('text-slate-400', 'text-blue-400');
            }

            // Event Listeners
            startBtn.addEventListener('click', executePipeline);
        });
    </script>
</body>
</html>