<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Plan Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container-box {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
        }
        .project-plan-card {
            border-left: 4px solid #3b82f6;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }
        .project-plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .feature-card {
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 flex items-center justify-center min-h-screen">

    <div class="max-w-7xl w-full mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Input Section -->
        <div class="md:col-span-1 container-box space-y-6 flex flex-col h-full">
            <h1 class="text-3xl font-bold text-gray-800">Project Plan Generator</h1>
            <p class="text-gray-600">Enter your project requirements below to generate a comprehensive plan.</p>
            <textarea id="requirementsInput" class="w-full h-64 p-4 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="e.g., 'Build an online food delivery web application that allows users to browse restaurants, place orders, and make payments. It should also have a dashboard for restaurants to manage their menus.'"></textarea>
            <button id="generateBtn" class="w-full py-3 px-6 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Generate Plan
            </button>
            <div id="loadingIndicator" class="text-center text-blue-600 font-semibold hidden">
                <div class="animate-spin inline-block w-8 h-8 border-[3px] border-current border-t-transparent text-blue-600 rounded-full" role="status">
                </div>
                <span class="ml-2">Generating your plan...</span>
            </div>
            <div id="errorIndicator" class="text-red-500 font-semibold mt-4 hidden"></div>

            <div class="mt-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Project Review Status</h2>
                <div id="reviewStatusContainer" class="space-y-4">
                    <!-- Status items will be injected here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Project Plan Section -->
        <div class="md:col-span-2 container-box">
            <div id="projectPlanContainer" class="space-y-8 hidden">
                <!-- Project plan will be injected here by JavaScript -->
            </div>
            <div id="initialState" class="text-center py-20 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-24 h-24 mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <line x1="10" y1="9" x2="8" y2="9" />
                </svg>
                <p>Your project plan will appear here after generation.</p>
            </div>
        </div>
    </div>

    <script type="module">
        const generateBtn = document.getElementById('generateBtn');
        const requirementsInput = document.getElementById('requirementsInput');
        const projectPlanContainer = document.getElementById('projectPlanContainer');
        const reviewStatusContainer = document.getElementById('reviewStatusContainer');
        const initialState = document.getElementById('initialState');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorIndicator = document.getElementById('errorIndicator');

        const roles = [
            "Technical Manager",
            "Senior Architect",
            "Business Analyst",
            "Senior Technical Lead",
            "QA Lead and Tester",
            "DevOps Engineer",
            "Senior Developer"
        ];

        let currentReviewerIndex = 0;
        let reviewStatus = roles.map(role => ({ role, status: 'Waiting' }));

        const renderReviewStatus = () => {
            reviewStatusContainer.innerHTML = '';
            reviewStatus.forEach((item, index) => {
                let statusColor = '';
                let statusIcon = '';
                if (item.status === 'Finished') {
                    statusColor = 'bg-green-100 text-green-600';
                    statusIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-8.86"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`;
                } else if (item.status === 'Progress') {
                    statusColor = 'bg-blue-100 text-blue-600';
                    statusIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v4"></path><path d="M12 18v4"></path><path d="M4.93 4.93l2.83 2.83"></path><path d="M16.24 16.24l2.83 2.83"></path><path d="M2 12h4"></path><path d="M18 12h4"></path><path d="M4.93 19.07l2.83-2.83"></path><path d="M16.24 7.76l2.83-2.83"></path></svg>`;
                } else {
                    statusColor = 'bg-gray-100 text-gray-500';
                    statusIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`;
                }
                const html = `
                    <div class="flex items-center space-x-3 p-4 rounded-lg shadow-sm ${statusColor}">
                        <div class="w-6 h-6 flex items-center justify-center rounded-full bg-white bg-opacity-70 text-gray-700">
                            ${statusIcon}
                        </div>
                        <span class="font-semibold text-sm">${item.role}</span>
                        <span class="text-xs ml-auto font-medium">${item.status}</span>
                    </div>
                `;
                reviewStatusContainer.innerHTML += html;
            });
        };

        const updateReviewStatus = () => {
            if (currentReviewerIndex < roles.length) {
                if (currentReviewerIndex > 0) {
                    reviewStatus[currentReviewerIndex - 1].status = 'Finished';
                }
                reviewStatus[currentReviewerIndex].status = 'Progress';
                currentReviewerIndex++;
                renderReviewStatus();
                if (currentReviewerIndex < roles.length) {
                    setTimeout(updateReviewStatus, 2000); // Simulate progress
                } else {
                    reviewStatus[roles.length - 1].status = 'Finished';
                    renderReviewStatus();
                }
            }
        };

        const renderProjectPlan = (plan) => {
            projectPlanContainer.innerHTML = '';
            initialState.classList.add('hidden');
            projectPlanContainer.classList.remove('hidden');

            let html = `<div class="p-6 bg-blue-50 rounded-lg mb-6 shadow-inner">
                            <h2 class="text-2xl font-bold text-gray-800">Project: ${plan.projectTitle}</h2>
                            <p class="text-gray-600 mt-2">A high-level overview of the project and its key components.</p>
                        </div>`;

            // Render Epics
            if (plan.epics && plan.epics.length > 0) {
                html += `<div class="space-y-6">`;
                plan.epics.forEach(epic => {
                    html += `
                        <div class="project-plan-card bg-white p-6 rounded-lg shadow-lg">
                            <h3 class="text-xl font-bold text-blue-600">${epic.name}</h3>
                            <p class="text-gray-600 mt-1">${epic.description}</p>
                            <div class="mt-4">
                                <span class="text-sm font-semibold text-gray-500">Estimated Days:</span>
                                <span class="text-sm font-bold text-gray-700">${epic.estimatedDays}</span>
                            </div>
                            <div class="mt-6 space-y-4">
                                <h4 class="text-lg font-semibold text-gray-800">Features</h4>
                                ${epic.features.map(feature => `
                                    <div class="feature-card p-4 bg-gray-50 flex items-center justify-between shadow-sm">
                                        <div>
                                            <p class="font-medium text-gray-700">${feature.name}</p>
                                            <p class="text-sm text-gray-500">${feature.description}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm font-semibold text-gray-600">${feature.featureType}</p>
                                            <p class="text-xs text-gray-400 mt-1">${feature.estimatedDays} days</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // Render Feedback Iterations
            if (plan.feedbackIterations && plan.feedbackIterations.length > 0) {
                html += `
                    <div class="mt-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Feedback & Iterations</h3>
                        <ol class="relative border-l border-gray-200 space-y-8">
                            ${plan.feedbackIterations.map(feedback => `
                                <li class="ml-6">
                                    <span class="absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    </span>
                                    <h4 class="flex items-center mb-1 text-md font-semibold text-gray-900">Iteration ${feedback.iteration}
                                        <span class="bg-blue-100 text-blue-800 text-sm font-medium ml-3 px-2 py-0.5 rounded-full">${feedback.feedbackBy}</span>
                                    </h4>
                                    <p class="mb-4 text-base font-normal text-gray-600">${feedback.comments}</p>
                                </li>
                            `).join('')}
                        </ol>
                    </div>
                `;
            }

            projectPlanContainer.innerHTML = html;
        };

        const generateProjectPlan = async (requirements) => {
            const systemPrompt = `
                You are a world-class Project Manager. Your task is to generate a comprehensive project plan based on the provided requirements. The plan must strictly adhere to the following JSON schema. Do not include any text before or after the JSON. Ensure all fields are filled accurately and realistically based on the project description.

                JSON Schema:
                {
                    "type": "OBJECT",
                    "properties": {
                        "projectTitle": { "type": "STRING" },
                        "epics": {
                            "type": "ARRAY",
                            "items": {
                                "type": "OBJECT",
                                "properties": {
                                    "name": { "type": "STRING" },
                                    "description": { "type": "STRING" },
                                    "features": {
                                        "type": "ARRAY",
                                        "items": {
                                            "type": "OBJECT",
                                            "properties": {
                                                "name": { "type": "STRING" },
                                                "description": { "type": "STRING" },
                                                "featureType": { "type": "STRING" },
                                                "estimatedDays": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "estimatedDays": { "type": "STRING" }
                                }
                            }
                        },
                        "feedbackIterations": {
                            "type": "ARRAY",
                            "items": {
                                "type": "OBJECT",
                                "properties": {
                                    "iteration": { "type": "NUMBER" },
                                    "comments": { "type": "STRING" },
                                    "feedbackBy": { "type": "STRING" }
                                }
                            }
                        }
                    },
                    "propertyOrdering": ["projectTitle", "epics", "feedbackIterations"]
                }
            `;
            const userQuery = `Generate a project plan for a project with the following requirements: "${requirements}"`;
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json"
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error('API call failed');
            }

            const result = await response.json();
            const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
            if (!jsonText) {
                throw new Error('Failed to parse API response.');
            }
            return JSON.parse(jsonText);
        };

        generateBtn.addEventListener('click', async () => {
            const requirements = requirementsInput.value.trim();
            if (!requirements) {
                errorIndicator.textContent = "Please enter project requirements.";
                errorIndicator.classList.remove('hidden');
                return;
            }

            errorIndicator.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            projectPlanContainer.classList.add('hidden');
            initialState.classList.add('hidden');
            generateBtn.disabled = true;

            try {
                // Reset and start the review status simulation
                currentReviewerIndex = 0;
                reviewStatus = roles.map(role => ({ role, status: 'Waiting' }));
                renderReviewStatus();
                updateReviewStatus();

                const planData = await generateProjectPlan(requirements);
                renderProjectPlan(planData);
            } catch (error) {
                errorIndicator.textContent = `Error generating plan: ${error.message}`;
                errorIndicator.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.disabled = false;
            }
        });

        // Initial rendering of the review status
        renderReviewStatus();
    </script>
</body>
</html>
