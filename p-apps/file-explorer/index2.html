<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glassmorphic Code Studio</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PrismJS for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Glassmorphism Background Animation */
        body {
            background: #0f172a;
            background-image: 
                radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(34, 197, 94, 0.15) 0px, transparent 50%);
            background-attachment: fixed;
            color: #e2e8f0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow: hidden;
        }

        /* Editor Overlay Logic */
        .code-editor-wrapper {
            position: relative;
            height: 100%;
            width: 100%;
            overflow: hidden;
            border-radius: 0.5rem;
        }

        .editor-layer {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            padding: 1.5rem;
            margin: 0;
            border: none;
            background: transparent;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            tab-size: 2;
            overflow: auto;
            white-space: pre;
            box-sizing: border-box; 
        }

        /* The syntax highlighted layer */
        #highlighting-layer {
            z-index: 1;
            pointer-events: none; /* Let clicks pass through to textarea */
        }
        
        #highlighting-layer code {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace !important;
        }

        /* The editable textarea */
        #editing-layer {
            z-index: 2;
            color: transparent; /* Text is transparent so we see highlighting below */
            caret-color: #fff; /* Cursor remains visible */
            outline: none;
            resize: none;
        }

        /* Selection color fix for transparent text */
        #editing-layer::selection {
            background: rgba(255, 255, 255, 0.15);
            color: transparent;
        }

        /* Glass Utility */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-panel-heavy {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(56, 189, 248, 0.2);
            border-left: 3px solid #38bdf8;
            color: #38bdf8;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <!-- Header -->
    <header class="h-14 glass-panel border-b border-white/10 flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-blue-500/20 rounded-lg text-blue-400">
                <i data-lucide="code-2" class="w-5 h-5"></i>
            </div>
            <h1 class="font-bold text-lg tracking-wide text-white/90">Glass<span class="text-blue-400">Dev</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 text-xs text-slate-400 bg-slate-800/50 px-3 py-1.5 rounded-full border border-white/5">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                Auto-saving
            </div>
            <button onclick="refreshPreview()" class="flex items-center gap-2 px-4 py-1.5 bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium rounded-lg transition-all shadow-lg shadow-blue-500/20">
                <i data-lucide="play" class="w-4 h-4"></i> Run
            </button>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar (File Explorer) -->
        <aside class="w-64 glass-panel-heavy flex flex-col shrink-0 z-10 transition-all duration-300" id="sidebar">
            <div class="p-4 text-xs font-semibold text-slate-400 uppercase tracking-wider flex justify-between items-center">
                <span>Explorer</span>
                <i data-lucide="folder-open" class="w-4 h-4"></i>
            </div>
            
            <nav class="flex-1 overflow-y-auto px-2 space-y-1" id="file-list">
                <!-- File items injected by JS -->
            </nav>

            <div class="p-4 border-t border-white/5">
                <div class="text-xs text-slate-500 flex items-center gap-2 justify-center">
                    <i data-lucide="info" class="w-3 h-3"></i>
                    <span>v1.0.2 Beta</span>
                </div>
            </div>
        </aside>

        <!-- Editor Area -->
        <section class="flex-1 flex flex-col min-w-0 bg-slate-900/30 relative">
            
            <!-- Tabs -->
            <div class="h-10 flex items-center bg-slate-950/40 border-b border-white/5 px-2 gap-1 overflow-x-auto" id="tabs-container">
                <!-- Tabs injected by JS -->
            </div>

            <!-- Code Editor Container -->
            <div class="flex-1 relative group">
                <div class="code-editor-wrapper bg-[#1e1e1e]/80">
                    <!-- Syntax Highlight Layer -->
                    <pre id="highlighting-layer" aria-hidden="true" class="editor-layer"><code class="language-javascript" id="highlighting-content"></code></pre>
                    <!-- Editable Layer -->
                    <textarea id="editing-layer" class="editor-layer" spellcheck="false" oninput="updateEditor(this.value); syncScroll(this);" onscroll="syncScroll(this);" onkeydown="handleKeyDown(event)"></textarea>
                </div>
                
                <!-- Status Bar -->
                <div class="absolute bottom-0 left-0 right-0 h-6 bg-blue-600/10 backdrop-blur-sm border-t border-white/5 flex items-center justify-end px-4 text-[10px] text-blue-300 gap-4 pointer-events-none">
                    <span id="cursor-pos">Ln 1, Col 1</span>
                    <span id="lang-indicator">JavaScript</span>
                </div>
            </div>
        </section>

        <!-- Preview Area (Resizable optional, fixed 40% for now) -->
        <aside class="w-[45%] flex flex-col border-l border-white/10 bg-black/20 backdrop-blur-sm" id="preview-pane">
            <div class="h-10 flex items-center justify-between bg-slate-950/40 border-b border-white/5 px-4">
                <span class="text-xs font-semibold text-slate-400 flex items-center gap-2">
                    <i data-lucide="globe" class="w-3 h-3"></i> Browser Preview
                </span>
                <div class="flex gap-2">
                     <button onclick="togglePreview()" class="p-1 hover:bg-white/10 rounded">
                        <i data-lucide="maximize-2" class="w-3 h-3 text-slate-400"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 relative bg-white rounded-bl-lg overflow-hidden">
                <iframe id="preview-frame" class="w-full h-full border-0" title="Preview"></iframe>
            </div>
        </aside>

    </main>

    <script>
        // --- Initialization ---
        lucide.createIcons();

        // --- State Management ---
        const files = {
            'index.html': {
                name: 'index.html',
                language: 'html',
                icon: 'file-code',
                color: 'text-orange-400',
                content: `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glass Preview</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Hello World</h1>
      <p>Edit the HTML, CSS, and JS files to see magic happen instantly.</p>
      <button id="clickBtn">Click Me</button>
    </div>
  </div>
  <script src="script.js"><\/script>
</body>
</html>`
            },
            'style.css': {
                name: 'style.css',
                language: 'css',
                icon: 'palette',
                color: 'text-blue-400',
                content: `body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.18);
  padding: 2rem;
  text-align: center;
  color: white;
  max-width: 300px;
}

h1 { margin-top: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }

button {
  background: white;
  color: #ff9a9e;
  border: none;
  padding: 10px 20px;
  border-radius: 20px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s;
}

button:hover {
  transform: scale(1.05);
}`
            },
            'script.js': {
                name: 'script.js',
                language: 'javascript',
                icon: 'file-json', // closest generic script icon
                color: 'text-yellow-400',
                content: `const btn = document.getElementById('clickBtn');

btn.addEventListener('click', () => {
  const r = Math.floor(Math.random() * 255);
  const g = Math.floor(Math.random() * 255);
  const b = Math.floor(Math.random() * 255);
  
  document.body.style.background = \`rgb(\${r},\${g},\${b})\`;
  
  btn.textContent = 'Color Changed!';
  setTimeout(() => btn.textContent = 'Click Me', 1000);
});`
            }
        };

        let currentFile = 'index.html';
        const editingLayer = document.getElementById('editing-layer');
        const highlightingContent = document.getElementById('highlighting-content');
        const highlightingLayer = document.getElementById('highlighting-layer');
        let updateTimeout;

        // --- Functions ---

        function renderSidebar() {
            const list = document.getElementById('file-list');
            list.innerHTML = '';
            
            Object.keys(files).forEach(filename => {
                const file = files[filename];
                const isActive = filename === currentFile;
                
                const div = document.createElement('div');
                div.className = `nav-item flex items-center gap-2 px-3 py-2 rounded-md cursor-pointer transition-all duration-200 group ${isActive ? 'active bg-white/5' : 'hover:bg-white/5 text-slate-400 hover:text-slate-200'}`;
                div.onclick = () => switchFile(filename);
                
                div.innerHTML = `
                    <i data-lucide="${file.icon}" class="w-4 h-4 ${file.color}"></i>
                    <span class="text-sm font-medium">${file.name}</span>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function renderTabs() {
            const container = document.getElementById('tabs-container');
            container.innerHTML = '';

            Object.keys(files).forEach(filename => {
                const isActive = filename === currentFile;
                const tab = document.createElement('div');
                tab.className = `flex items-center gap-2 px-3 py-1.5 text-xs border-t-2 cursor-pointer transition-colors ${isActive ? 'bg-[#1e1e1e]/80 border-blue-500 text-white' : 'border-transparent text-slate-500 hover:text-slate-300 hover:bg-white/5'}`;
                tab.onclick = () => switchFile(filename);
                
                // Icon
                const file = files[filename];
                
                tab.innerHTML = `
                   <span class="${file.color}">${filename}</span>
                   ${isActive ? '<span class="w-1.5 h-1.5 rounded-full bg-blue-500 ml-1"></span>' : ''}
                `;
                container.appendChild(tab);
            });
        }

        function switchFile(filename) {
            // Save current file content before switching
            if (files[currentFile]) {
                files[currentFile].content = editingLayer.value;
            }

            currentFile = filename;
            const file = files[filename];
            
            // Update editor content
            editingLayer.value = file.content;
            
            // Update Highlight Class
            highlightingContent.className = `language-${file.language}`;
            
            // Update UI
            document.getElementById('lang-indicator').innerText = file.language.toUpperCase();
            renderSidebar();
            renderTabs();
            
            // Trigger highlight and scroll reset
            updateEditor(file.content);
            editingLayer.scrollTop = 0;
            editingLayer.scrollLeft = 0;
            syncScroll(editingLayer);
        }

        function updateEditor(text) {
            // Escape HTML for the pre/code block
            let formatted = text.replace(/&/g, "&amp;")
                                .replace(/</g, "&lt;")
                                .replace(/>/g, "&gt;")
                                .replace(/"/g, "&quot;")
                                .replace(/'/g, "&#039;");
            
            // Handle final newline visual bug in pre tags
            if (text[text.length - 1] === "\n") {
                formatted += " ";
            }

            highlightingContent.innerHTML = formatted;
            
            // Apply Prism Highlighting
            Prism.highlightElement(highlightingContent);

            // Update stored state
            files[currentFile].content = text;

            // Debounce preview update
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(refreshPreview, 800);
        }

        function syncScroll(element) {
            highlightingLayer.scrollTop = element.scrollTop;
            highlightingLayer.scrollLeft = element.scrollLeft;
            
            // Update cursor position tracking
            const val = element.value.substr(0, element.selectionStart);
            const lines = val.split("\n");
            const line = lines.length;
            const col = lines[lines.length - 1].length + 1;
            document.getElementById('cursor-pos').innerText = `Ln ${line}, Col ${col}`;
        }

        function handleKeyDown(e) {
            // Support Tab Indentation
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;

                // Set textarea value to: text before caret + tab + text after caret
                e.target.value = e.target.value.substring(0, start) +
                    "  " + e.target.value.substring(end);

                // Put caret at right position again
                e.target.selectionStart = e.target.selectionEnd = start + 2;
                
                // Trigger update
                updateEditor(e.target.value);
            }
        }

        function refreshPreview() {
            const iframe = document.getElementById('preview-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            
            const html = files['index.html'].content;
            const css = files['style.css'].content;
            const js = files['script.js'].content;

            // Inject CSS and JS into HTML
            // We use regex to replace external links with inline content for the preview
            
            let previewContent = html;
            
            // Replace css link
            if (previewContent.includes('<link rel="stylesheet" href="style.css">')) {
                previewContent = previewContent.replace('<link rel="stylesheet" href="style.css">', `<style>${css}</style>`);
            } else {
                // Fallback if user removed the link tag
                previewContent = previewContent.replace('</head>', `<style>${css}</style></head>`);
            }

            // Replace js script
            if (previewContent.includes('<script src="script.js"><\/script>')) {
                 previewContent = previewContent.replace('<script src="script.js"><\/script>', `<script>${js}<\/script>`);
            } else {
                 // Fallback
                 previewContent = previewContent.replace('</body>', `<script>${js}<\/script></body>`);
            }

            doc.open();
            doc.write(previewContent);
            doc.close();
        }

        // --- Start ---
        // Initialize with default file
        switchFile('index.html');
        refreshPreview();

    </script>
</body>
</html>

